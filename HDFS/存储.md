java写的

# 存储

存储模型：字节

线性切割  

  切割成块 块大小不变 
  偏移量 记录位置
  平均 处理能力差不多
  按字节 把字符集切断了
  
  副本  3个 可靠 放在不同节点
  
  只支持一次写入多次读取 
  
  可以追加数据 append

# 架构

主从架构 一主多从

接受客户端的读写服务
收集DataNode的block列表
主节点存放文件的元数据 
元数据 属性信息 块大小 块偏移量  anac。conf

从节点存放文件具体块数据
使用本地文件系统存储文件
启动后会 主从心跳 提交block列表
存储本地block的元数据  md5 

lost 
10分钟

client 拿数据 两次  先和 主节点拿数据  

(主) NameNode 
(从) DataNode

结构图

# 持久化

NameNode 基于内存存储  不与磁盘发生交互
单向持久化

保存的元数据

文件大小 

两种方法

  fsimage
    定点快照 存储到磁盘  写入满 恢复快
  edits
    增量的全局操作日志   对metadata的操作日志  写入快 恢复慢
  
  过程 format
  
  edits数据膨胀 edits合并到fsimages
  
  合并
  
  SecondaryNameNode
  帮助NameNode合并fsimages edits
  2.x版本以后不用
  
  合并时机
  checkpoint 
  
  启动前先读取fsimages
  
  
  # 特点
  
  
  优点
  
  大文件
  
  缺点
  
  延迟  分钟级别
  
  
  小文件存储 不适合
  
  并发写入 只能有一个写入 
  
  
  # 副本放置策略
  
  
  # 流程
  
  ## 写流程
  
  NameNode path
  
  切割数据块  指定 dataNode  
  流式传递
  自动备份
  
  ## 读流程
  
  就近流程
  
  md5 验证 数据的完整性
  
  # 权限
  
  HDFS文件权限  POSIX标准
  
  和linux权限类似
  
  
 阻止误操作 
 
 # 安全模式
 
 # 角色
 
 NN DN SND
 
 
  
  
  





